# MTS Content Chat

Интерактивный помощник для анализа популярности и вовлечённости контента на YouTube  
(и его хранения в реестре MTS Web Services Tables).

Проект сделан в рамках хакатона **МТС Hack&Change**.

Он позволяет:
- анализировать **любой YouTube-канал** (по ID, @handle или ссылке),
- считать метрики просмотров, лайков, комментариев и вовлечённости,
- задавать вопросы в чате на естественном языке,
- при наличии доступа — синхронизировать данные в таблицу MWS как реестр контента.

---

## Демо

Приложение задеплоено на Render и доступно по адресу:

> `https://mts-contest.onrender.com/`  

(подставь сюда реальный URL сервиса).

В демо можно:
- указать YouTube-канал,
- задать вопросы типа:
  - «какое самое популярное видео из последних пяти?»  
  - «какие 3 видео с самой высокой вовлечённостью из последних десяти?»  
  - «на каких роликах больше всего лайков?»

---

## Основные возможности

1. **Аналитика YouTube-канала**
   - Получение последних N видео канала.
   - Статистика: `views`, `likes`, `comments`.
   - Расчёт метрики вовлечённости:
     \[
       engagement\_rate = \frac{likes + comments}{views}
     \]

2. **Гибкий выбор канала**
   - Поддерживаются форматы:
     - `@handle` — `@TheBrianMaps`
     - ссылка на канал — `https://www.youtube.com/@TheBrianMaps`
     - ссылка на видео — `https://youtu.be/...` или `https://www.youtube.com/watch?v=...`
     - channelId вида `UC...`
   - Канал по умолчанию можно задать в `.env` через `YOUTUBE_CHANNEL_ID`.

3. **Понимание вопроса**
   - Вопрос разбирается, чтобы определить:
     - про просмотры или про вовлечённость,
     - по скольким **последним N** видео делать анализ (`5`, `10` и т.п.).
   - Примеры:
     - «из последних пяти» → N = 5  
     - «из последних десяти» → N = 10  
     - «из последних 7 видео» → N = 7  

4. **Умный ответ**
   - Строится топ-3 материалов:
     - либо по просмотрам,
     - либо по вовлечённости.
   - В ответ входят:
     - название,
     - просмотры / лайки / комментарии,
     - вовлечённость,
     - ссылка на видео.
   - Ниже даётся короткий вывод:
     - сравнение с средними значениями,
     - рекомендации, какие форматы развивать.

5. **Интеграция с MTS Web Services (Tables) — опционально**
   - Эндпоинт `/sync`:
     - получает последние видео с YouTube,
     - считает метрики,
     - записывает **новые** записи в таблицу в MWS (без дублей по `external_id`),
     - таблица выступает как **реестр контента**.
   - Эндпоинт `/chat`:
     - сначала пытается брать данные из MWS,
     - если данных нет / MWS не настроен — берёт напрямую из YouTube.

6. **LLM-аналитика (через OpenRouter) — тоже опционально**
   - Если задать `OPENROUTER_API_KEY`, ответы может формировать LLM.
   - Если LLM недоступна, используется локальный аналитический генератор ответа (без ошибок и падений).

---

## Архитектура

Упрощённо:

```text
YouTube API ──────► FastAPI backend ◄───── MWS Tables (реестр контента)
                        │
                        ▼
                   Аналитика / LLM
                        │
                        ▼
                    Web UI (чат)
